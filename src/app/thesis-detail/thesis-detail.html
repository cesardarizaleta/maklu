<div class="thesis-detail">
  <header class="header">
    <button class="back-btn" (click)="goBack()">← Volver al Dashboard</button>
    @if (thesis(); as t) {
      <div class="header-actions">
        <button class="export-btn word-btn" (click)="exportToWord()" [disabled]="t.status === 'generating'">
          <svg class="export-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10,9 9,9 8,9"/>
          </svg>
          Word
        </button>
        <button class="export-btn pdf-btn" (click)="exportToPDF()" [disabled]="t.status === 'generating'">
          <svg class="export-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <path d="M9 15v-6l2 2 2-2v6"/>
          </svg>
          PDF
        </button>
      </div>
      <h1>{{ t.title }}</h1>
      <span class="status" [class]="t.status">{{ t.status }}</span>
    } @else {
      <h1>Cargando...</h1>
    }
  </header>

  <main class="main">
    @if (loading()) {
      <div class="loading">Cargando tesis...</div>
    } @else if (thesis()) {
      <div class="thesis-content">
        @if (thesis()!.status === 'generating') {
          <div class="generating-notice">
            <div class="spinner"></div>
            <p>Tu tesis se está generando. Esto puede tomar varios minutos...</p>
          </div>
        }

        @for (section of getSections(); track section) {
          <section class="thesis-section">
            <h2 class="section-title">{{ getSectionTitle(section) }}</h2>

            @for (part of getPartsBySection()[section]; track part.id) {
              <div class="part-card">
                <div class="part-header">
                  <h3>{{ part.title }}</h3>
                  <button class="edit-btn" (click)="startEdit(part)">Editar</button>
                </div>

                @if (editingPart() === part.key) {
                  <div class="edit-mode">
                    <textarea
                      [(ngModel)]="editContent"
                      rows="10"
                      placeholder="Contenido de la parte..."
                    ></textarea>
                    <div class="edit-actions">
                      <button class="save-btn" (click)="saveEdit()">Guardar</button>
                      <button class="cancel-btn" (click)="cancelEdit()">Cancelar</button>
                    </div>
                  </div>
                } @else {
                  <div class="part-content">
                    {{ part.content }}
                  </div>
                }
              </div>
            }
          </section>
        }
      </div>
    } @else {
      <div class="error">Error al cargar la tesis</div>
    }
  </main>
</div>
